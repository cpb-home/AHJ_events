(()=>{"use strict";class t{constructor(){this._position}get position(){return this._position}set position(t){this._position=t}createNewPosition(t){let i=Number(Math.floor(Math.random()*t**2));for(;i===this._position;)i=Number(Math.floor(Math.random()*t**2));return i}}const i=new class{constructor(){this.boardSize=4,this.container=null,this.boardEl=null,this.cells=[],this.cellClickListeners=[],this.timoutId,this.leftChars=0}drawUi(){this.checkBinding(),this.container.innerHTML='\n      <div class="score">Счёт игры: <span>0</span></div>\n      <div class="board-container">\n        <div data-id="board" class="board"></div>\n      </div>\n      <div class="leftChars">Пропущено: <span>0</span></div>\n      <div class="lost">Игра окончена. Вы проиграли!</div>\n    ',this.boardEl=this.container.querySelector("[data-id=board]");for(let t=0;t<this.boardSize**2;t+=1){const i=document.createElement("div");i.classList.add("cell"),i.dataset.number=t,i.addEventListener("click",(t=>this.onCellClick(t))),this.boardEl.appendChild(i)}this.cells=Array.from(this.boardEl.children)}checkBinding(){if(null===this.container)throw new Error("GamePlay not bind to DOM")}redrawPosition(t,i){const e=t.createNewPosition(i);t.position=e;for(const t of this.cells)Number(t.dataset.number)===e?t.innerHTML='<img class="charImg" src="./img/goblin.png" alt="">':t.innerHTML="";this.timoutId=setTimeout((()=>{clearTimeout(this.timoutId),this.redrawPosition(t,i);const e=document.querySelector(".leftChars").querySelector("span");this.leftChars+=1,e.textContent=this.leftChars,this.leftChars>4&&this.gameOver()}),1e3)}bindToDOM(t){if(!(t instanceof HTMLElement))throw new Error("container is not HTMLElement");this.container=t}onCellClick(t){clearTimeout(this.timoutId);const i=t.currentTarget.dataset.number;this.cellClickListeners.forEach((t=>t.call(null,i)))}addCellClickListener(t){this.cellClickListeners.push(t)}gameOver(){clearTimeout(this.timoutId),this.cellClickListeners=[],document.querySelector(".lost").style.display="block"}};i.bindToDOM(document.querySelector("#game-container"));const e=new class{constructor(i){this.gamePlay=i,this.char=new t,this.click=!1}init(){this.gamePlay.drawUi(),this.gamePlay.redrawPosition(this.char,this.gamePlay.boardSize),this.gamePlay.addCellClickListener(this.onCellClick.bind(this))}onCellClick(t){this.click=!0;const i=document.querySelector(".score").querySelector("span");Number(t)===this.char.position?(i.textContent=Number(i.textContent)+1,this.gamePlay.leftChars=0):i.textContent=Number(i.textContent)-1,this.click=!0,this.gamePlay.redrawPosition(this.char,this.gamePlay.boardSize)}}(i);e.init()})();